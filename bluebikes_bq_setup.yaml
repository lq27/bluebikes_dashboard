id: bluebikes_ingest
namespace: bluebikes

tasks:
  - id: set_up_dataset
    type: io.kestra.plugin.gcp.bigquery.Query
    sql: |
      CREATE SCHEMA IF NOT EXISTS `{{kv('GCP_BQ_DATASET')}}`
      OPTIONS (
        location = 'US'
      ); 


  - id: all_trip_data
    type: io.kestra.plugin.gcp.bigquery.Query
    sql: |
      CREATE TABLE IF NOT EXISTS `{{kv('GCP_PROJECT_ID')}}.{{kv('GCP_BQ_DATASET')}}.all_trip_data`
      (
        unique_row_id BYTES,
        fileid STRING, 
        ride_id	STRING,
        rideable_type	STRING,	
        started_at	TIMESTAMP,	
        ended_at	TIMESTAMP,	
        start_station_name	STRING,	
        start_station_id	STRING,	
        end_station_name	STRING,	
        end_station_id	STRING,	
        start_lat	FLOAT64,	
        start_lng	FLOAT64,	
        end_lat	FLOAT64,	
        end_lng	FLOAT64,	
        member_casual	STRING,	
        bikeid	STRING
      )